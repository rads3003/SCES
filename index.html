<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simulador de Capacitaci√≥n - Guardias de Seguridad</title>
  <style>
    :root {
      --bg-primary: #0a0e1a;
      --bg-secondary: #141827;
      --bg-card: #1a1f35;
      --accent: #00d9ff;
      --accent-glow: rgba(0, 217, 255, 0.3);
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --text-primary: #ffffff;
      --text-secondary: #94a3b8;
      --border: rgba(255, 255, 255, 0.1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #0a0e1a 0%, #1a1f35 100%);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Animated background particles */
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }

    .particle {
      position: absolute;
      width: 2px;
      height: 2px;
      background: var(--accent);
      border-radius: 50%;
      opacity: 0.3;
      animation: float 20s infinite;
    }

    @keyframes float {
      0%, 100% { transform: translate(0, 0); opacity: 0; }
      50% { opacity: 0.5; }
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      position: relative;
      z-index: 1;
    }

    header {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 30px;
      padding: 25px;
      background: linear-gradient(135deg, var(--bg-card) 0%, rgba(26, 31, 53, 0.6) 100%);
      border-radius: 20px;
      border: 1px solid var(--border);
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    }

    .logo {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, var(--accent) 0%, #0080ff 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: 0 4px 20px var(--accent-glow);
    }

    h1 {
      font-size: 28px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent) 0%, #ffffff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      color: var(--text-secondary);
      font-size: 14px;
      margin-top: 5px;
    }

    .header-actions {
      margin-left: auto;
      display: flex;
      gap: 10px;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    button.primary {
      background: linear-gradient(135deg, var(--accent) 0%, #0080ff 100%);
      color: #070a1a;
      box-shadow: 0 4px 15px var(--accent-glow);
    }

    button.primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 25px var(--accent-glow);
    }

    button.ghost {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-secondary);
    }

    button.ghost:hover {
      background: var(--bg-card);
      color: var(--text-primary);
      border-color: var(--accent);
    }

    .card {
      background: linear-gradient(135deg, var(--bg-card) 0%, rgba(26, 31, 53, 0.8) 100%);
      border-radius: 16px;
      padding: 24px;
      border: 1px solid var(--border);
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
    }

    .card:hover {
      border-color: var(--accent);
      box-shadow: 0 8px 32px var(--accent-glow);
    }

    .main-layout {
      display: grid;
      grid-template-columns: 1fr 350px;
      gap: 20px;
    }

    /* Area Selection */
    .area-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .area-card {
      cursor: pointer;
      position: relative;
      overflow: hidden;
      padding: 30px;
      text-align: center;
      transition: all 0.3s ease;
    }

    .area-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--accent) 0%, #0080ff 100%);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }

    .area-card.selected {
      border-color: var(--accent);
      background: linear-gradient(135deg, rgba(0, 217, 255, 0.1) 0%, rgba(0, 128, 255, 0.05) 100%);
    }
    
    .area-card:hover::before {
      transform: scaleX(1);
    }

    .area-icon {
      font-size: 48px;
      margin-bottom: 15px;
      filter: drop-shadow(0 4px 8px var(--accent-glow));
    }

    .area-card h3 {
      font-size: 20px;
      margin-bottom: 10px;
      color: var(--accent);
    }

    /* Scenario Cards */
    .scenarios-grid {
      display: grid;
      gap: 15px;
      margin-top: 20px;
    }

    .scenario-card {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .scenario-card:hover {
        border-color: var(--accent);
    }

    .scenario-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: var(--accent);
      transform: scaleY(0);
      transition: transform 0.3s ease;
    }

    .scenario-card:hover::before {
      transform: scaleY(1);
    }

    .difficulty-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 10px;
    }

    .difficulty-facil {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
    }

    .difficulty-medio {
      background: rgba(245, 158, 11, 0.2);
      color: var(--warning);
    }

    .difficulty-alto {
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger);
    }

    /* Game View */
    .game-container {
      min-height: 500px;
    }

    .scenario-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding: 20px;
      background: linear-gradient(135deg, rgba(0, 217, 255, 0.1) 0%, transparent 100%);
      border-radius: 12px;
      border-left: 4px solid var(--accent);
    }

    .timer {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 18px;
      font-weight: 600;
      color: var(--accent);
      padding: 10px 20px;
      background: rgba(0, 217, 255, 0.1);
      border-radius: 8px;
    }

    .timer.warning {
      color: var(--warning);
      background: rgba(245, 158, 11, 0.1);
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    .node-content {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.02) 100%);
      padding: 30px;
      border-radius: 12px;
      margin-bottom: 25px;
      border-left: 4px solid var(--accent);
      position: relative;
      animation: slideIn 0.5s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .node-text {
      font-size: 18px;
      line-height: 1.6;
      margin-bottom: 20px;
    }

    .choices-grid {
      display: grid;
      gap: 15px;
    }

    .choice-btn {
      padding: 20px;
      text-align: left;
      background: linear-gradient(135deg, var(--bg-card) 0%, rgba(26, 31, 53, 0.6) 100%);
      border: 2px solid var(--border);
      border-radius: 12px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      cursor: pointer;
      /* FORZAR LETRAS BLANCAS PARA MEJOR VISUALIZACION */
      color: var(--text-primary); 
    }

    .choice-btn * { /* Aplicar tambi√©n a sub-elementos para garantizar el contraste */
        color: var(--text-primary) !important;
    }

    .choice-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, var(--accent) 0%, #0080ff 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .choice-btn:hover {
      border-color: var(--accent);
      transform: translateX(10px);
    }

    .choice-btn:hover::before {
      opacity: 0.1;
    }

    .choice-title {
      font-weight: 600;
      font-size: 16px;
      margin-bottom: 8px;
      position: relative;
      z-index: 1;
    }

    .choice-effects {
      font-size: 13px;
      color: var(--text-secondary);
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      position: relative;
      z-index: 1;
    }

    .effect-tag {
      padding: 3px 10px;
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.05);
      font-size: 12px;
    }

    /* Sobrescribir el color del texto del tag solo donde sea necesario */
    .effect-positive {
      color: var(--success) !important;
      background: rgba(16, 185, 129, 0.1);
    }

    .effect-negative {
      color: var(--danger) !important;
      background: rgba(239, 68, 68, 0.1);
    }

    /* Feedback Section */
    .feedback-card {
      margin-top: 20px;
      padding: 20px;
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, transparent 100%);
      border-left: 4px solid var(--success);
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .feedback-card.warning {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, transparent 100%);
      border-left-color: var(--danger);
    }

    /* Sidebar */
    .sidebar {
      position: sticky;
      top: 20px;
      height: fit-content;
    }

    .user-panel {
      margin-bottom: 20px;
    }

    .user-input {
      width: 100%;
      padding: 12px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 14px;
      margin-top: 10px; /* Added spacing for new fields */
    }

    /* Override for first input */
    #user-name {
        margin-top: 10px; /* To separate from h3 */
    }
    
    .user-input:focus {
      outline: none;
      border-color: var(--accent);
      background: rgba(0, 217, 255, 0.05);
    }

    .dimensions-list {
      display: grid;
      gap: 12px;
      margin-top: 15px;
    }

    .dimension-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .dimension-item:hover {
      background: rgba(0, 217, 255, 0.05);
    }

    .dimension-label {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .dimension-value {
      font-weight: 700;
      font-size: 18px;
      color: var(--accent);
    }

    .progress-bar-container {
      margin-top: 20px;
      padding: 20px;
      background: linear-gradient(135deg, rgba(0, 217, 255, 0.05) 0%, transparent 100%);
      border-radius: 12px;
    }

    .progress-bar {
      width: 100%;
      height: 12px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 999px;
      overflow: hidden;
      margin-top: 10px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent) 0%, #0080ff 100%);
      border-radius: 999px;
      transition: width 0.5s ease;
      box-shadow: 0 0 20px var(--accent-glow);
    }

    /* Report View */
    .report-container {
      max-width: 800px;
      margin: 0 auto;
    }

    .report-header {
      text-align: center;
      padding: 40px;
      background: linear-gradient(135deg, rgba(0, 217, 255, 0.1) 0%, transparent 100%);
      border-radius: 16px;
      margin-bottom: 30px;
    }

    .final-score {
      font-size: 64px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent) 0%, #0080ff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 20px 0;
    }

    .report-section {
      margin-bottom: 25px;
    }

    .report-section h3 {
      color: var(--accent);
      margin-bottom: 15px;
      font-size: 20px;
    }

    .action-list {
      display: grid;
      gap: 10px;
    }

    .action-item {
      padding: 15px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 8px;
      border-left: 3px solid var(--accent);
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: var(--bg-card);
      border-radius: 16px;
      padding: 30px;
      max-width: 500px;
      width: 90%;
      border: 1px solid var(--border);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      animation: modalSlide 0.3s ease;
    }

    @keyframes modalSlide {
      from {
        opacity: 0;
        transform: translateY(-50px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @media (max-width: 1024px) {
      .main-layout {
        grid-template-columns: 1fr;
      }

      .sidebar {
        position: static;
      }
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 20px;
      }

      .header-actions {
        flex-wrap: wrap;
      }

      .area-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="particles" id="particles"></div>

  <div id="notification-modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-title" style="color: var(--accent); margin-bottom: 15px;"></h3>
            <p id="modal-message" style="color: var(--text-primary); margin-bottom: 20px;"></p>
            <button class="primary" onclick="hideModal()">Aceptar</button>
        </div>
    </div>


  <div class="container">
    <header>
      <div class="logo">üõ°Ô∏è</div>
      <div style="flex: 1;">
        <h1>Simulador de Conocimientos para Eventos Cr√≠ticos - SCEC</h1>
        <div class="subtitle">Entrena decisiones cr√≠ticas con escenarios realistas y feedback inmediato</div>
      </div>
      <div class="header-actions">
        <button class="ghost" id="btn-tts">üîä Voz</button>
        <button class="ghost" id="btn-admin">‚öôÔ∏è Admin</button>
        <button class="ghost" id="btn-reset">‚ôªÔ∏è Reset</button>
      </div>
    </header>

    <div class="main-layout">
      <main>
        <div id="view-area" class="card">
          <h2 style="margin-bottom: 20px;">Selecciona tu √°rea de desempe√±o</h2>
          <div class="area-grid">
            <div class="area-card card" data-area="comercial" tabindex="0">
              <div class="area-icon">üè™</div>
              <h3>Comercial / Retail</h3>
              <p style="color: var(--text-secondary);">Mall, supermercados y centros comerciales. Enfoque en atenci√≥n al p√∫blico, prevenci√≥n de hurtos y emergencias.</p>
            </div>
            <div class="area-card card" data-area="industrial" tabindex="0">
              <div class="area-icon">üè≠</div>
              <h3>Industrial</h3>
              <p style="color: var(--text-secondary);">Plantas industriales - seguridad de per√≠metro, maquinaria, riesgos qu√≠micos y emergencias laborales.</p>
            </div>
            <div class="area-card card" data-area="servicio" tabindex="0">
              <div class="area-icon">üè¢</div>
              <h3>Servicio / Corporativo</h3>
              <p style="color: var(--text-secondary);">Edificios de oficinas, corporativos y de servicios. Enfoque en control de acceso, paquetes sospechosos y protecci√≥n ejecutiva.</p>
            </div>
            <div class="area-card card" data-area="salud" tabindex="0">
              <div class="area-icon">üè•</div>
              <h3>Salud / Hospitalario</h3>
              <p style="color: var(--text-secondary);">Cl√≠nicas, laboratorios  y hospitales. Enfoque en control de visitas, usuarios, manejo de personas agresivas y seguridad de zonas sensibles.</p>
            </div>
            <div class="area-card card" data-area="mineria" tabindex="0">
              <div class="area-icon">‚õèÔ∏è</div>
              <h3>Miner√≠a</h3>
              <p style="color: var(--text-secondary);">Faenas y sitios de extracci√≥n remotos. Enfoque en seguridad perimetral, control de ingreso, materiales de alto valor y respuesta a accidentes con maquinaria.</p>
            </div>
            <div class="area-card card" data-area="energia" tabindex="0">
              <div class="area-icon">‚ö°</div>
              <h3>Energ√≠a</h3>
              <p style="color: var(--text-secondary);">Subestaciones, plantas de poder e infraestructura cr√≠tica. Enfoque en prevenci√≥n de sabotaje, control de acceso y manejo de emergencias.</p>
            </div>
          </div>

          <div id="scenarios-container" style="display: none; margin-top: 30px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
              <h3>Escenarios disponibles</h3>
              <button class="primary" id="btn-random">üé≤ Iniciar Aleatorio</button>
            </div>
            <div class="scenarios-grid" id="scenarios-list"></div>
          </div>
        </div>

        <div id="view-play" style="display: none;">
          <div class="card game-container">
            <div class="scenario-header">
              <div>
                <h2 id="scenario-title">T√≠tulo del Escenario</h2>
                <div class="subtitle" id="scenario-meta">Meta info</div>
              </div>
              <div class="timer" id="timer">
                <span>‚è±Ô∏è</span>
                <span id="timer-value">00:00</span>
              </div>
            </div>

            <div class="node-content">
              <div class="node-text" id="node-text"></div>
              <div id="node-media"></div>
            </div>

            <div class="choices-grid" id="choices"></div>
          </div>

          <div class="card feedback-card" id="feedback-card" style="display: none;">
            <h3 style="margin-bottom: 10px;">üìã Feedback Inmediato</h3>
            <div id="immediate-feedback"></div>
            <div style="margin-top: 10px; color: var(--text-secondary);">
              Acciones realizadas: <strong id="actions-count" style="color: var(--accent);">0</strong>
            </div>
          </div>
        </div>

        <div id="view-report" style="display: none;">
          <div class="report-container">
            <div class="card report-header">
              <h2>üèÜ Reporte Final</h2>
              <div class="final-score" id="final-score">85%</div>
              <div class="subtitle">Excelente desempe√±o en este escenario</div>
            </div>

            <div class="card report-section">
              <h3>üìä Dimensiones Evaluadas</h3>
              <div id="report-dimensions"></div>
            </div>

            <div class="card report-section">
              <h3>üìù Acciones Registradas</h3>
              <div class="action-list" id="report-actions"></div>
            </div>

            <div class="card report-section">
              <h3>üí° Retroalimentaci√≥n</h3>
              <div id="report-feedback"></div>
            </div>

            <div style="display: flex; gap: 15px; margin-top: 25px;">
              <button class="ghost" id="btn-export-json">üì• Descargar JSON</button>
              <button class="ghost" id="btn-print">üñ®Ô∏è Imprimir PDF</button>
              <button class="primary" id="btn-replay" style="margin-left: auto;">üîÑ Reintentar Escenario</button>
            </div>
          </div>
        </div>
      </main>

      <aside class="sidebar">
        <div class="card user-panel">
          <h3 style="margin-bottom: 15px;">üë§ Usuario</h3>
          <input type="text" class="user-input" id="user-name" placeholder="Ingresa tu Nombre">
          <input type="text" class="user-input" id="user-rut" placeholder="Ingresa tu RUT (Ej: 12.345.678-9)">
          <input type="text" class="user-input" id="user-facility" placeholder="Instalaci√≥n/Sede">
          
          <div style="margin-top: 20px;">
            <div style="color: var(--text-secondary); font-size: 13px; margin-bottom: 10px;">Sesiones guardadas: <strong id="sessions-count" style="color: var(--accent);">0</strong></div>
            <div style="display: flex; gap: 10px;">
              <button class="ghost" id="btn-save-session" style="flex: 1;">üíæ Guardar</button>
              <button class="ghost" id="btn-load-session" style="flex: 1;">üìÇ Cargar</button>
            </div>
          </div>
        </div>

        <div class="card">
          <h3 style="margin-bottom: 15px;">üìä Dimensiones</h3>
          <div class="dimensions-list">
            <div class="dimension-item">
              <span class="dimension-label">Procedimental</span>
              <span class="dimension-value" id="dim-procedural">0</span>
            </div>
            <div class="dimension-item">
              <span class="dimension-label">Seguridad</span>
              <span class="dimension-value" id="dim-security">0</span>
            </div>
            <div class="dimension-item">
              <span class="dimension-label">Comunicaciones</span>
              <span class="dimension-value" id="dim-comms">0</span>
            </div>
            <div class="dimension-item">
              <span class="dimension-label">Tiempo</span>
              <span class="dimension-value" id="dim-time">0</span>
            </div>
            <div class="dimension-item">
              <span class="dimension-label">Empat√≠a</span>
              <span class="dimension-value" id="dim-empathy">0</span>
            </div>
          </div>

          <div class="progress-bar-container">
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
              <span style="font-size: 14px;">Progreso Total</span>
              <span style="font-weight: 600; color: var(--accent);" id="partial-score">0%</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" id="progress-bar" style="width: 0%"></div>
            </div>
          </div>
        </div>

        <div class="card" id="admin-panel" style="display: none; margin-top: 20px;">
          <h3 style="margin-bottom: 15px;">‚öôÔ∏è Panel de Administraci√≥n</h3>
          <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 15px;">
            Edita o pega JSON de escenarios personalizados
          </p>
          <textarea id="admin-json" class="user-input" style="height: 200px; font-family: monospace; font-size: 12px;" placeholder="{ ... }"></textarea>
          <div style="display: flex; gap: 10px; margin-top: 15px;">
            <button class="primary" id="btn-load-json" style="flex: 1;">üì§ Cargar JSON</button>
            <button class="ghost" id="btn-export-json-admin" style="flex: 1;">üì• Exportar</button>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <script>
    // Configuraci√≥n
    const DIMENSIONS = ['procedural', 'security', 'comms', 'time', 'empathy'];
    const WEIGHTS = {procedural: 0.4, security: 0.3, comms: 0.15, time: 0.1, empathy: 0.05};
    
    // Estado del juego
    let gameState = {
      currentArea: null,
      currentScenario: null,
      currentNode: null,
      dimensions: {procedural: 0, security: 0, comms: 0, time: 0, empathy: 0},
      actions: [],
      startTime: null,
      timerInterval: null,
      score: 0,
    };
    
    // --- L√≥gica del Modal de Notificaci√≥n ---
    function showModal(title, message) {
        document.getElementById('modal-title').textContent = title;
        document.getElementById('modal-message').innerHTML = message;
        document.getElementById('notification-modal').classList.add('active');
    }

    function hideModal() {
        document.getElementById('notification-modal').classList.remove('active');
    }

    // Funciones de utilidad de la interfaz
    function switchView(viewId) {
        document.getElementById('view-area').style.display = 'none';
        document.getElementById('view-play').style.display = 'none';
        document.getElementById('view-report').style.display = 'none';
        
        // Esconder feedback al cambiar de vista
        document.getElementById('feedback-card').style.display = 'none';

        const targetView = document.getElementById(viewId);
        if (targetView) {
            targetView.style.display = 'block';
        }
    }
    
    function updateTimerDisplay() {
        if (!gameState.startTime) return;
        const elapsed = Math.floor((Date.now() - gameState.startTime) / 1000);
        const minutes = String(Math.floor(elapsed / 60)).padStart(2, '0');
        const seconds = String(elapsed % 60).padStart(2, '0');
        const timerElement = document.getElementById('timer-value');
        timerElement.textContent = `${minutes}:${seconds}`;
        
        // Alerta visual de tiempo
        const timerContainer = document.getElementById('timer');
        if (elapsed > 300) { // 5 minutos de advertencia
             timerContainer.classList.add('warning');
        } else {
             timerContainer.classList.remove('warning');
        }
    }

    function startTimer() {
        clearInterval(gameState.timerInterval);
        gameState.startTime = Date.now();
        gameState.timerInterval = setInterval(updateTimerDisplay, 1000);
    }

    function stopTimer() {
        clearInterval(gameState.timerInterval);
    }
    
    function updateDimensionsDisplay() {
        DIMENSIONS.forEach(dim => {
            document.getElementById(`dim-${dim}`).textContent = gameState.dimensions[dim];
        });
        document.getElementById('actions-count').textContent = gameState.actions.length;
        
        const currentScore = calculatePartialScore();
        document.getElementById('partial-score').textContent = `${currentScore}%`;
        document.getElementById('progress-bar').style.width = `${currentScore}%`;
    }

    function calculatePartialScore() {
        let totalWeightedScore = 0;
        let maxTheoreticalScore = 20; // Maximum ideal score in points (e.g., 20)
        
        // Max sum of weighted points if all dimensions scored 20: 
        // (20 * 0.4) + (20 * 0.3) + (20 * 0.15) + (20 * 0.1) + (20 * 0.05) = 20
        
        DIMENSIONS.forEach(dim => {
            totalWeightedScore += gameState.dimensions[dim] * WEIGHTS[dim];
        });
        
        // Normalize the score to a 0-100 range, capping at 100.
        // We use a factor of 5 to scale max 20 points to 100%.
        const normalizedScore = Math.min(100, Math.max(0, totalWeightedScore * 5)); 
        return Math.round(normalizedScore);
    }
    
    // --- L√≥gica del Juego ---
    
    function selectArea(areaId) {
        gameState.currentArea = areaId;
        const scenarios = SCENARIOS[areaId];
        const list = document.getElementById('scenarios-list');
        list.innerHTML = '';
        
        // Activar la clase 'selected'
        document.querySelectorAll('.area-card').forEach(card => card.classList.remove('selected'));
        const selectedCard = document.querySelector(`.area-card[data-area="${areaId}"]`);
        if (selectedCard) {
            selectedCard.classList.add('selected');
        }

        scenarios.forEach(scenario => {
            const card = document.createElement('div');
            card.className = 'scenario-card card';
            card.dataset.scenarioId = scenario.id;
            card.setAttribute('tabindex', '0');
            
            // CORREGIDO: El bot√≥n "Iniciar" debe llamar a startScenario con el ID correcto
            card.innerHTML = `
                <div>
                    <h4>${scenario.title} <span class="difficulty-badge difficulty-${scenario.difficulty}">Dif. ${scenario.difficulty.charAt(0).toUpperCase() + scenario.difficulty.slice(1)}</span></h4>
                    <p style="color: var(--text-secondary); font-size: 13px;">Tiempo estimado: ${scenario.est_time} min</p>
                </div>
                <button class="primary" onclick="startScenario('${scenario.id}')">Iniciar</button>
            `;
            list.appendChild(card);
        });

        document.getElementById('scenarios-container').style.display = 'block';
    }

    function startScenario(scenarioId) {
        const areaId = gameState.currentArea;
        const scenario = SCENARIOS[areaId].find(s => s.id === scenarioId);
        if (!scenario) return;

        // 1. Resetear Estado
        gameState.currentScenario = scenario;
        gameState.dimensions = {procedural: 0, security: 0, comms: 0, time: 0, empathy: 0};
        gameState.actions = [];
        
        // 2. Iniciar UI
        document.getElementById('scenario-title').textContent = scenario.title;
        document.getElementById('scenario-meta').textContent = `√Årea: ${scenario.area.toUpperCase()} | Dificultad: ${scenario.difficulty.toUpperCase()}`;
        updateDimensionsDisplay();
        startTimer();
        
        // 3. Cambiar Vista y Cargar Nodo Inicial
        switchView('view-play');
        loadNode(scenario.start);
    }
    
    function loadNode(nodeId) {
        const scenario = gameState.currentScenario;
        const node = scenario.nodes[nodeId];
        gameState.currentNode = nodeId; // Actualizar el nodo actual

        document.getElementById('node-text').textContent = node.text;
        document.getElementById('feedback-card').style.display = 'none'; // Esconder feedback al avanzar

        const choicesDiv = document.getElementById('choices');
        choicesDiv.innerHTML = '';

        if (node.type === 'end') {
            stopTimer();
            const finalScore = calculatePartialScore();
            showReport(finalScore, node.text);
            return;
        }

        if (node.choices) {
            node.choices.forEach(choiceId => {
                const choice = scenario.choices[choiceId];
                const choiceBtn = document.createElement('button');
                choiceBtn.className = 'choice-btn';
                choiceBtn.onclick = () => takeChoice(choiceId);
                
                // Generar HTML de efectos (tags)
                const effectsHtml = DIMENSIONS.map(dim => {
                    const value = choice.effects[dim] || 0;
                    if (value !== 0) {
                        const type = value > 0 ? 'positive' : 'negative';
                        // NOTA: El color del texto del tag se maneja en el CSS
                        return `<span class="effect-tag effect-${type}">${dim.toUpperCase()}: ${value > 0 ? '+' : ''}${value}</span>`;
                    }
                    return '';
                }).join('');

                // TODO EL TEXTO DEL choice-btn ES FORZADO A BLANCO EN EL CSS
                choiceBtn.innerHTML = `
                    <div class="choice-title">${choice.desc}</div>
                    <div class="choice-effects">${effectsHtml}</div>
                `;
                choicesDiv.appendChild(choiceBtn);
            });
        }
    }
    
    function takeChoice(choiceId) {
        const scenario = gameState.currentScenario;
        const choice = scenario.choices[choiceId];

        // Aplicar efectos
        let totalEffect = 0;
        let isBadChoice = false;

        DIMENSIONS.forEach(dim => {
            const effect = choice.effects[dim] || 0;
            gameState.dimensions[dim] += effect;
            totalEffect += effect;
            if (effect < 0) isBadChoice = true;
        });

        // Log de acci√≥n
        gameState.actions.push({
            node: gameState.currentNode,
            choice: choice.desc,
            effects: choice.effects,
            timestamp: Date.now() - gameState.startTime,
            scoreChange: totalEffect
        });

        // Generar Feedback
        let feedback = `**Decisi√≥n:** ${choice.desc}<br>`;
        if (totalEffect > 0) {
             feedback += `<span style="color: var(--success);">‚úÖ ¬°Elecci√≥n Positiva! Has aplicado el protocolo o mostrado la actitud correcta.</span>`;
        } else if (totalEffect < 0) {
             feedback += `<span style="color: var(--danger);">‚ùå ¬°Riesgo/Falla! Esta acci√≥n ha afectado negativamente el resultado.</span>`;
        } else {
             feedback += `<span style="color: var(--warning);">‚ö†Ô∏è Elecci√≥n Neutral. Se tom√≥ una acci√≥n, pero no resolvi√≥ el problema.</span>`;
        }

        // Actualizar Display
        updateDimensionsDisplay();
        
        // Mostrar feedback
        const feedbackCard = document.getElementById('feedback-card');
        feedbackCard.className = `card feedback-card ${isBadChoice ? 'warning' : ''}`;
        document.getElementById('immediate-feedback').innerHTML = feedback;
        feedbackCard.style.display = 'block';

        // Cargar siguiente nodo
        loadNode(choice.to);
    }
    
    function showReport(finalScore, finalText) {
        // L√≥gica simplificada de reporte
        document.getElementById('final-score').textContent = `${finalScore}%`;
        document.getElementById('report-feedback').innerHTML = `**Resultado del Escenario:** ${finalText}`;
        
        // Dimensiones
        const reportDim = document.getElementById('report-dimensions');
        reportDim.innerHTML = DIMENSIONS.map(dim => {
            return `<div class="dimension-item"><span class="dimension-label">${dim.toUpperCase()}</span><span class="dimension-value">${gameState.dimensions[dim]}</span></div>`;
        }).join('');

        // Acciones
        const reportActions = document.getElementById('report-actions');
        reportActions.innerHTML = gameState.actions.map(action => {
             const time = (action.timestamp / 1000).toFixed(1);
             const type = action.scoreChange > 0 ? 'success' : action.scoreChange < 0 ? 'danger' : 'warning';
             return `<div class="action-item" style="border-left-color: var(--${type});">
                        <p><strong>${action.choice}</strong> (Efecto: ${action.scoreChange > 0 ? '+' : ''}${action.scoreChange} pts)</p>
                        <small style="color: var(--text-secondary);">Tiempo: ${time}s</small>
                    </div>`;
        }).join('');
        
        switchView('view-report');
    }

    // --- Inicializaci√≥n y Funcionalidad de Botones ---
    
    function init() {
        // 1. Adjuntar Listeners de Selecci√≥n de √Årea
        document.querySelectorAll('.area-card').forEach(card => {
            card.addEventListener('click', () => {
                selectArea(card.dataset.area);
            });
        });

        // 2. Botones de Navegaci√≥n y Control
        document.getElementById('btn-reset').addEventListener('click', () => {
            stopTimer();
            switchView('view-area');
            document.getElementById('scenarios-container').style.display = 'none';
        });
        
        document.getElementById('btn-replay').addEventListener('click', () => {
            if (gameState.currentScenario) {
                startScenario(gameState.currentScenario.id);
            } else {
                switchView('view-area');
            }
        });

        // 3. Funcionalidad de Botones de Control (Simulaciones)
        document.getElementById('btn-tts').addEventListener('click', () => {
            showModal('üîä M√≥dulo de Voz', 'Simulaci√≥n: La funcionalidad de **Texto a Voz (TTS)** ha sido activada para la lectura de escenarios y alternativas. Desactivar para operar en silencio t√°ctico.');
        });

        document.getElementById('btn-admin').addEventListener('click', () => {
            const adminPanel = document.getElementById('admin-panel');
            if (adminPanel.style.display === 'none') {
                adminPanel.style.display = 'block';
                showModal('‚öôÔ∏è Panel de Administraci√≥n', 'Acceso a la configuraci√≥n. Se recomienda cautela al modificar los par√°metros JSON.');
            } else {
                adminPanel.style.display = 'none';
            }
        });
        
        document.getElementById('btn-save-session').addEventListener('click', () => {
            showModal('üíæ Guardar Sesi√≥n', 'Simulaci√≥n: Su progreso actual ha sido guardado localmente bajo el nombre de **' + (document.getElementById('user-name').value || 'Usuario An√≥nimo') + '**.');
        });

        document.getElementById('btn-load-session').addEventListener('click', () => {
            showModal('üìÇ Cargar Sesi√≥n', 'Simulaci√≥n: Se ha cargado la sesi√≥n anterior (si exist√≠a). Revise sus m√©tricas de dimensiones y el contador de sesiones.');
        });

        document.getElementById('btn-export-json').addEventListener('click', () => {
            showModal('üì• Descargar Reporte', 'Simulaci√≥n: El reporte final de su desempe√±o y el log de acciones ha sido exportado como **JSON/PDF** para an√°lisis posterior (Inteligencia Post-Acci√≥n).');
        });

        document.getElementById('btn-print').addEventListener('click', () => {
             showModal('üñ®Ô∏è Imprimir Reporte', 'Simulaci√≥n: Se ha generado una vista de impresi√≥n del **Reporte Final** para documentaci√≥n oficial de capacitaci√≥n.');
        });

        document.getElementById('btn-load-json').addEventListener('click', () => {
            showModal('üì§ Cargar JSON (Admin)', 'Simulaci√≥n: JSON cargado. Los nuevos escenarios personalizados est√°n disponibles en el √°rea seleccionada.');
        });

        document.getElementById('btn-export-json-admin').addEventListener('click', () => {
            showModal('üì• Exportar JSON (Admin)', 'Simulaci√≥n: El JSON de escenarios cargado o editado ha sido exportado exitosamente.');
        });
        
        document.getElementById('btn-random').addEventListener('click', () => {
            if (!gameState.currentArea) {
                showModal('‚ö†Ô∏è Alerta T√°ctica', 'Seleccione un **√Årea de Desempe√±o** primero para que el generador aleatorio pueda operar con criterios geogr√°ficos.');
                return;
            }
            const scenarios = SCENARIOS[gameState.currentArea];
            const randomIndex = Math.floor(Math.random() * scenarios.length);
            startScenario(scenarios[randomIndex].id);
        });

        // 4. Establecer vista inicial
        switchView('view-area');
    }

    window.onload = init;
  </script>
  
  <script>
    // Escenarios de ejemplo (Mismos que en la respuesta anterior, funcionales y con 2+ casos por √°rea)
    let SCENARIOS = {
      "comercial": [
        {
          id: 'c_hurto_simple',
          title: 'Hurto en pasillo',
          area: 'comercial',
          difficulty: 'facil',
          est_time: 5,
          start: 'n_start',
          nodes: {
            n_start: {type: 'info', text: 'Son las 15:30. Un cliente reporta que alguien meti√≥ art√≠culos al abrigo. Se oyen murmullos en el pasillo.', choices: ['c_approach', 'c_call']},
            n_approach: {type: 'event', text: 'Te acercas y ves a una persona con un producto sin pagar. Hay 2 testigos mirando la situaci√≥n.', choices: ['c_confront', 'c_follow', 'c_await_backup']},
            n_wait: {type: 'event', text: 'Pides apoyo y esperas 45 segundos. Llega personal de tienda para coordinar.', choices: ['c_coord', 'c_ignore']},
            n_end_ok: {type: 'end', text: 'Detenci√≥n pac√≠fica completada. Se realiza reporte y el cliente respira tranquilo. Procedimiento correcto aplicado.'},
            n_end_fail: {type: 'end', text: 'El sospechoso huye causando un empuj√≥n. Un cliente resulta lesionado. Habr√° investigaci√≥n interna.'}
          },
          choices: {
            c_approach: {from: 'n_start', to: 'n_approach', effects: {procedural: 5, security: -5}, desc: 'Acercarse inmediatamente sin apoyo'},
            c_call: {from: 'n_start', to: 'n_wait', effects: {procedural: 8, security: 10, comms: 15}, desc: 'Reportar situaci√≥n y pedir backup'},
            c_confront: {from: 'n_approach', to: 'n_end_fail', effects: {procedural: -10, security: -15, empathy: -5}, desc: 'Confrontar al sospechoso inmediatamente, sin esperar apoyo'},
            c_follow: {from: 'n_approach', to: 'n_wait', effects: {procedural: 5, security: 5, time: -10}, desc: 'Seguir discretamente mientras pides apoyo'},
            c_await_backup: {from: 'n_approach', to: 'n_wait', effects: {procedural: 10, security: 10}, desc: 'Mantener la distancia y esperar apoyo para el acercamiento'},
            c_coord: {from: 'n_wait', to: 'n_end_ok', effects: {procedural: 15, security: 15, comms: 10, empathy: 5, time: 5}, desc: 'Coordinar con personal de tienda para un acercamiento conjunto y protocolar'},
            c_ignore: {from: 'n_wait', to: 'n_end_fail', effects: {procedural: -15, security: -20}, desc: 'Decidir que no es un riesgo y dejar que se vaya, violando el protocolo'}
          }
        },
        {
          id: 'c_incendio_foodcourt',
          title: 'Incendio en patio de comidas',
          area: 'comercial',
          difficulty: 'alto',
          est_time: 8,
          start: 'n_start',
          nodes: {
            n_start: {type: 'info', text: 'Alarma de incendio en el patio de comidas. Se ve humo denso saliendo de un local de comida r√°pida. P√°nico leve.', choices: ['c_check', 'c_alarm', 'c_direct']},
            n_check: {type: 'event', text: 'Te diriges al foco del humo. El fuego es peque√±o pero se est√° propagando r√°pidamente en la campana extractora.', choices: ['c_extinguish', 'c_evac_zone']},
            n_alarm: {type: 'event', text: 'Activas la alarma general y llamas a emergencia (bomberos/jefatura) desde el puesto central.', choices: ['c_evac_full', 'c_wait_firemen']},
            n_end_ok: {type: 'end', text: 'Evacuaci√≥n exitosa y contenci√≥n del fuego inicial. Se minimizan los da√±os y no hay heridos. El procedimiento de emergencia funcion√≥.'},
            n_end_fail: {type: 'end', text: 'El p√°nico aumenta, la evacuaci√≥n es ca√≥tica. El fuego se propaga al techo. Graves da√±os materiales y posibles heridos.'}
          },
          choices: {
            c_check: {from: 'n_start', to: 'n_check', effects: {time: -10, security: -5}, desc: 'Ir a ver la magnitud antes de actuar'},
            c_alarm: {from: 'n_start', to: 'n_alarm', effects: {procedural: 10, comms: 15, time: 5}, desc: 'Activar alarma general y llamar a emergencias'},
            c_direct: {from: 'n_start', to: 'n_end_fail', effects: {security: -10, comms: -10}, desc: 'Gritar √≥rdenes de evacuaci√≥n sin activar alarmas'},
            c_extinguish: {from: 'n_check', to: 'n_end_fail', effects: {security: -15, procedural: -10}, desc: 'Intentar apagar el fuego solo con un extintor port√°til'},
            c_evac_zone: {from: 'n_check', to: 'n_alarm', effects: {procedural: 5, security: 10}, desc: 'Comenzar evacuaci√≥n del √°rea de riesgo inmediato'},
            c_evac_full: {from: 'n_alarm', to: 'n_end_ok', effects: {procedural: 20, security: 20, comms: 10}, desc: 'Dirigir la evacuaci√≥n completa y establecer per√≠metro de seguridad'},
            c_wait_firemen: {from: 'n_alarm', to: 'n_end_fail', effects: {time: -15, security: -15}, desc: 'Esperar pasivamente la llegada de los bomberos'}
          }
        },
        // ESCENARIO SOLICITADO: Contenci√≥n de persona con trastornos psicol√≥gicos
        {
          id: 'c_crisis_psicologica',
          title: 'Contenci√≥n de Cliente en Crisis',
          area: 'comercial',
          difficulty: 'alto',
          est_time: 8,
          start: 'n_start',
          nodes: {
            n_start: {type: 'info', text: 'Un cliente en el √°rea de cajas est√° gritando incoherencias, agitando los brazos y golpeando la cinta transportadora. El p√∫blico se asusta y se aleja.', choices: ['c_intervene_distance', 'c_call_security_chief', 'c_physical_restraint']},
            n_intervene_distance: {type: 'event', text: 'Te acercas con calma, manteniendo 3 metros de distancia, en posici√≥n no agresiva. El cliente te mira fijamente, pero no se mueve.', choices: ['c_talk_calmly', 'c_ask_what_happened', 'c_approach_closer']},
            n_talk_calmly: {type: 'event', text: 'Usas una voz suave, repitiendo frases de desescalada y preguntando su nombre. Gana 10 segundos de su atenci√≥n.', choices: ['c_offer_safe_area', 'c_call_paramedics']},
            n_end_ok: {type: 'end', text: 'El cliente acepta ser acompa√±ado a un √°rea privada, donde el personal m√©dico de emergencia se hace cargo. Evitaste la confrontaci√≥n y protegiste al p√∫blico. Excelente manejo de crisis.'},
            n_end_fail_physical: {type: 'end', text: 'El intento de contenci√≥n f√≠sica causa una reacci√≥n violenta. El cliente y el guardia sufren heridas leves. Falla en el protocolo de desescalada.'},
            n_end_fail_delay: {type: 'end', text: 'La demora o la falta de apoyo permiten que el cliente rompa una vitrina antes de ser contenido. Da√±o material y trauma a los testigos.'}
          },
          choices: {
            c_intervene_distance: {from: 'n_start', to: 'n_intervene_distance', effects: {procedural: 10, security: 5, empathy: 5}, desc: 'Acercarse manteniendo la distancia de seguridad (buffer zone)'},
            c_call_security_chief: {from: 'n_start', to: 'n_intervene_distance', effects: {procedural: 5, comms: 10, time: -10}, desc: 'Llamar a la central de inmediato y solicitar apoyo, luego acercarse'},
            c_physical_restraint: {from: 'n_start', to: 'n_end_fail_physical', effects: {security: -15, empathy: -10}, desc: 'Intentar la contenci√≥n f√≠sica de inmediato sin desescalada'},
            c_talk_calmly: {from: 'n_intervene_distance', to: 'n_talk_calmly', effects: {empathy: 15, comms: 10, procedural: 5}, desc: 'Usar lenguaje verbal y corporal de desescalada'},
            c_ask_what_happened: {from: 'n_intervene_distance', to: 'n_end_fail_delay', effects: {empathy: -5, time: -5}, desc: 'Hacer preguntas abiertas sobre el problema (riesgo de aumentar la agitaci√≥n)'},
            c_approach_closer: {from: 'n_intervene_distance', to: 'n_end_fail_physical', effects: {security: -10}, desc: 'Acortar la distancia de seguridad sin una se√±al positiva'},
            c_offer_safe_area: {from: 'n_talk_calmly', to: 'n_end_ok', effects: {procedural: 15, security: 10, empathy: 10, comms: 5, time: 5}, desc: 'Ofrecer acompa√±amiento a un lugar privado y seguro'},
            c_call_paramedics: {from: 'n_talk_calmly', to: 'n_end_ok', effects: {procedural: 10, comms: 15, time: 10}, desc: 'Coordinar la llegada de ayuda m√©dica especializada (ideal si hay desescalada inicial)'}
          }
        }
      ],
      "industrial": [
        {
          id: 'i_quimico_leak',
          title: 'Fuga de Qu√≠mico Leve',
          area: 'industrial',
          difficulty: 'medio',
          est_time: 7,
          start: 'n_start',
          nodes: {
            n_start: {type: 'info', text: 'Se detecta un olor fuerte y se observa una peque√±a fuga en una v√°lvula de un contenedor de qu√≠micos no vitales.', choices: ['c_isolate', 'c_check_alone', 'c_alarm_full']},
            n_isolate: {type: 'event', text: 'Has aislado el √°rea inmediata con cinta. Ahora debes decidir qu√© acci√≥n tomar sobre la fuga misma.', choices: ['c_try_contain', 'c_wait_hsm']},
            n_alarm_full: {type: 'event', text: 'Activaste la alarma de emergencia y notificaste a HAZMAT. El equipo de respuesta est√° en camino.', choices: ['c_evac_zone', 'c_wait_in_place']},
            n_end_ok: {type: 'end', text: 'La fuga fue contenida con √©xito por el equipo HAZMAT sin riesgo para el personal. Procedimiento de respuesta de emergencia correcto.'},
            n_end_fail: {type: 'end', text: 'La fuga escal√≥ antes de la llegada del personal. Hubo una exposici√≥n leve y la producci√≥n se detuvo por horas.'}
          },
          choices: {
            c_isolate: {from: 'n_start', to: 'n_isolate', effects: {procedural: 10, security: 5}, desc: 'Aislar el √°rea inmediata y notificar al supervisor'},
            c_check_alone: {from: 'n_start', to: 'n_end_fail', effects: {security: -15, procedural: -10}, desc: 'Acercarse para verificar la v√°lvula sin EPP ni apoyo'},
            c_alarm_full: {from: 'n_start', to: 'n_alarm_full', effects: {procedural: 15, comms: 10, time: 5}, desc: 'Activar alarma y llamar al equipo de respuesta a materiales peligrosos (HAZMAT)'},
            c_try_contain: {from: 'n_isolate', to: 'n_end_fail', effects: {security: -10, time: -5}, desc: 'Intentar cerrar la v√°lvula sin entrenamiento o EPP especializado'},
            c_wait_hsm: {from: 'n_isolate', to: 'n_alarm_full', effects: {procedural: 5, time: 10}, desc: 'Mantener per√≠metro y esperar al equipo de Seguridad y Medio Ambiente (HSM)'},
            c_evac_zone: {from: 'n_alarm_full', to: 'n_end_ok', effects: {procedural: 15, security: 15}, desc: 'Dirigir la evacuaci√≥n segura del personal en la zona afectada'},
            c_wait_in_place: {from: 'n_alarm_full', to: 'n_end_fail', effects: {time: -10, security: -5}, desc: 'Quedarse en el puesto de control esperando al equipo de respuesta'}
          }
        },
        {
          id: 'i_acceso_maquinaria',
          title: 'Acceso No Autorizado a Bodega de Maquinaria',
          area: 'industrial',
          difficulty: 'facil',
          est_time: 4,
          start: 'n_start',
          nodes: {
            n_start: {type: 'info', text: 'Un contratista sin la autorizaci√≥n necesaria intenta acceder a la bodega de maquinaria pesada. Se ve frustrado y discute con el encargado de turno.', choices: ['c_check_auth', 'c_deny_entry_soft', 'c_ignore_dispute']},
            n_check_auth: {type: 'event', text: 'Solicitas la documentaci√≥n de acceso. El contratista tiene un permiso de otro d√≠a y se queja de un "error".', choices: ['c_call_super_ind', 'c_allow_entry']},
            n_end_ok: {type: 'end', text: 'El problema se resuelve revisando la programaci√≥n. Se aplica el protocolo de control de acceso correctamente, manteniendo buenas relaciones.'},
            n_end_fail: {type: 'end', text: 'El contratista entra a la bodega y causa un da√±o menor a un equipo por desconocimiento de las normas internas.'}
          },
          choices: {
            c_check_auth: {from: 'n_start', to: 'n_check_auth', effects: {procedural: 10, comms: 5}, desc: 'Intervenir y solicitar la documentaci√≥n de acceso al contratista'},
            c_deny_entry_soft: {from: 'n_start', to: 'n_end_ok', effects: {procedural: 5, empathy: 5}, desc: 'Negar la entrada inmediatamente pero con calma y sugiriendo la oficina de administraci√≥n'},
            c_ignore_dispute: {from: 'n_start', to: 'n_end_fail', effects: {security: -10, procedural: -5}, desc: 'Dejar que el encargado de turno resuelva la disputa sin tu intervenci√≥n'},
            c_call_super_ind: {from: 'n_check_auth', to: 'n_end_ok', effects: {procedural: 15, comms: 10}, desc: 'Llamar al supervisor de contrato o de seguridad para verificar el permiso'},
            c_allow_entry: {from: 'n_check_auth', to: 'n_end_fail', effects: {security: -15, procedural: -10}, desc: 'Permitirle la entrada a pesar de la documentaci√≥n incorrecta'}
          }
        }
      ],
      "servicio": [
        {
          id: 's_acceso_no_autorizado',
          title: 'Acceso No Autorizado',
          area: 'servicio',
          difficulty: 'facil',
          est_time: 4,
          start: 'n_start',
          nodes: {
            n_start: {type: 'info', text: 'Una persona sin credencial intenta acceder a un piso restringido. Alega ser nuevo contratista.', choices: ['c_ask_id', 'c_deny_entry', 'c_ignore']},
            n_ask_id: {type: 'event', text: 'Pides amablemente su identificaci√≥n y un contacto de la empresa. El hombre se pone nervioso.', choices: ['c_call_super', 'c_insist_entry']},
            n_end_ok: {type: 'end', text: 'El sospechoso es un ex-empleado con intenciones de hurto. Detenido por la polic√≠a. Procedimiento correcto y emp√°tico.'},
            n_end_fail: {type: 'end', text: 'El individuo logra entrar al edificio. Hay reportes de robo en una oficina 5 minutos despu√©s.'}
          },
          choices: {
            c_ask_id: {from: 'n_start', to: 'n_ask_id', effects: {procedural: 10, empathy: 5}, desc: 'Solicitar identificaci√≥n y contacto de manera cort√©s'},
            c_deny_entry: {from: 'n_start', to: 'n_end_fail', effects: {empathy: -10, comms: -5}, desc: 'Negar la entrada inmediatamente sin m√°s preguntas'},
            c_ignore: {from: 'n_start', to: 'n_end_fail', effects: {security: -15, procedural: -10}, desc: 'Asumir que es verdad y dejarlo pasar'},
            c_call_super: {from: 'n_ask_id', to: 'n_end_ok', effects: {procedural: 15, security: 10, comms: 10}, desc: 'Llamar al supervisor para verificar la situaci√≥n y pedir apoyo discreto'},
            c_insist_entry: {from: 'n_ask_id', to: 'n_end_fail', effects: {security: -10, empathy: -5}, desc: 'Presionar al hombre a irse sin llamar a nadie'}
          }
        },
        {
          id: 's_paquete_sospechoso',
          title: 'Descubrimiento de Paquete Sospechoso',
          area: 'servicio',
          difficulty: 'medio',
          est_time: 6,
          start: 'n_start',
          nodes: {
            n_start: {type: 'info', text: 'Un bolso olvidado en el lobby por m√°s de 1 hora. Nadie lo reclama. No hay c√°maras cerca.', choices: ['c_approach_check', 'c_isolate_call', 'c_announce']},
            n_isolate_call: {type: 'event', text: 'Has establecido un per√≠metro de seguridad inicial y notificaste a tu central y a la polic√≠a.', choices: ['c_wait_expert', 'c_move_package']},
            n_end_ok: {type: 'end', text: 'Paquete analizado y declarado seguro. El procedimiento de seguridad y la comunicaci√≥n fueron perfectos. Minimizaste el riesgo.'},
            n_end_fail: {type: 'end', text: 'El paquete conten√≠a material pirot√©cnico inestable. Hubo una explosi√≥n menor y p√°nico entre los ocupantes.'}
          },
          choices: {
            c_approach_check: {from: 'n_start', to: 'n_end_fail', effects: {security: -20, procedural: -15}, desc: 'Acercarse e inspeccionar el contenido del bolso'},
            c_isolate_call: {from: 'n_start', to: 'n_isolate_call', effects: {procedural: 15, security: 15, comms: 10, time: 5}, desc: 'Establecer per√≠metro, no tocar y notificar inmediatamente a las autoridades'},
            c_announce: {from: 'n_start', to: 'n_end_fail', effects: {empathy: -5, procedural: -5}, desc: 'Anunciar por altavoz sobre el bolso perdido (puede alertar al due√±o si es malicioso)'},
            c_wait_expert: {from: 'n_isolate_call', to: 'n_end_ok', effects: {procedural: 10, security: 10}, desc: 'Mantener el per√≠metro y esperar que el equipo experto se haga cargo'},
            c_move_package: {from: 'n_isolate_call', to: 'n_end_fail', effects: {security: -25, procedural: -20}, desc: 'Mover el paquete a un lugar m√°s seguro (por si acaso)'}
          }
        }
      ],
      "salud": [
        {
          id: 'h_agresion_medica',
          title: 'Agresi√≥n en Sala de Espera',
          area: 'salud',
          difficulty: 'medio',
          est_time: 5,
          start: 'n_start',
          nodes: {
            n_start: {type: 'info', text: 'En la sala de espera de urgencias, un familiar enfurecido de un paciente comienza a gritar y empuja a una enfermera. Nadie interviene.', choices: ['c_intervene_solo', 'c_call_backup', 'c_use_force']},
            n_call_backup: {type: 'event', text: 'Pides refuerzos por radio mientras mantienes contacto visual. El hombre se acerca a la enfermera de nuevo.', choices: ['c_verbal_calm', 'c_physical_block']},
            n_end_ok: {type: 'end', text: 'El hombre es inmovilizado y calmado hasta la llegada de la polic√≠a. La enfermera est√° a salvo y no hay heridos. Aplicaste protocolos de desescalada.'},
            n_end_fail: {type: 'end', text: 'La situaci√≥n se sale de control. Otros pacientes y personal se involucran y resultan heridos. Da√±o a la reputaci√≥n del centro.'}
          },
          choices: {
            c_intervene_solo: {from: 'n_start', to: 'n_call_backup', effects: {security: -5, time: -5}, desc: 'Acercarse solo para interponerse f√≠sicamente sin apoyo'},
            c_call_backup: {from: 'n_start', to: 'n_call_backup', effects: {procedural: 10, comms: 10, time: 5}, desc: 'Pedir refuerzos y mantener la distancia para evaluar la amenaza'},
            c_use_force: {from: 'n_start', to: 'n_end_fail', effects: {security: -15, empathy: -15}, desc: 'Usar fuerza f√≠sica de inmediato para someterlo'},
            c_verbal_calm: {from: 'n_call_backup', to: 'n_end_ok', effects: {procedural: 15, empathy: 10, comms: 5}, desc: 'Utilizar t√©cnicas de desescalada verbal, manteniendo la calma'},
            c_physical_block: {from: 'n_call_backup', to: 'n_end_fail', effects: {security: -10, empathy: -5}, desc: 'Bloquear al hombre, iniciando el contacto f√≠sico antes de tener apoyo'}
          }
        },
        {
          id: 'h_paciente_fuga',
          title: 'Fuga de Paciente Psiqui√°trico',
          area: 'salud',
          difficulty: 'alto',
          est_time: 7,
          start: 'n_start',
          nodes: {
            n_start: {type: 'info', text: 'Un paciente de la unidad psiqui√°trica logra salir de su √°rea. El personal de enfermer√≠a te pide ayuda para recapturarlo.', choices: ['c_pursuit', 'c_isolate_and_call', 'c_ask_description']},
            n_pursuit: {type: 'event', text: 'Lo encuentras en el jard√≠n, agitado y asustado. No est√° agrediendo a nadie.', choices: ['c_calm_talk', 'c_try_catch']},
            n_end_ok: {type: 'end', text: 'El paciente fue devuelto a la unidad sin incidentes, usando comunicaci√≥n y contenci√≥n m√≠nima. Procedimiento basado en el cuidado.'},
            n_end_fail: {type: 'end', text: 'El paciente se autolesiona o agrede al guardia durante la captura. Investigaci√≥n interna en curso.'}
          },
          choices: {
            c_pursuit: {from: 'n_start', to: 'n_pursuit', effects: {time: -5, procedural: 5}, desc: 'Iniciar la b√∫squeda inmediata por las √°reas conocidas'},
            c_isolate_and_call: {from: 'n_start', to: 'n_end_ok', effects: {procedural: 10, comms: 10, security: 10}, desc: 'Aislar las salidas, asegurar el per√≠metro y llamar a apoyo especializado del hospital'},
            c_ask_description: {from: 'n_start', to: 'n_pursuit', effects: {procedural: 8}, desc: 'Recabar m√°s detalles sobre el estado del paciente antes de la b√∫squeda'},
            c_calm_talk: {from: 'n_pursuit', to: 'n_end_ok', effects: {empathy: 15, procedural: 10}, desc: 'Usar t√©cnicas de comunicaci√≥n para calmarlo y convencerlo de volver'},
            c_try_catch: {from: 'n_pursuit', to: 'n_end_fail', effects: {security: -15, empathy: -10}, desc: 'Intentar la contenci√≥n f√≠sica sin t√©cnicas de desescalada'}
          }
        }
      ],
      "mineria": [
        {
          id: 'm_intruso_perimetro',
          title: 'Intrusi√≥n Perimetral - √Årea Restringida',
          area: 'mineria',
          difficulty: 'alto',
          est_time: 10,
          start: 'n_start',
          nodes: {
            n_start: {type: 'info', text: 'El CCTV muestra a una persona cortando la cerca del per√≠metro en una zona oscura cerca de la bodega de alto valor. Se activa la alarma silenciosa.', choices: ['c_send_patrol', 'c_monitor_only', 'c_call_police']},
            n_send_patrol: {type: 'event', text: 'Env√≠as una patrulla de dos guardias, sin saber si el intruso est√° armado. Deben acercarse con precauci√≥n.', choices: ['c_intercept', 'c_establish_overwatch']},
            n_call_police: {type: 'event', text: 'Contactas a la polic√≠a y mantienes la vigilancia. El intruso comienza a moverse hacia la bodega.', choices: ['c_intercept_soft', 'c_wait_police']},
            n_end_ok: {type: 'end', text: 'El intruso fue inmovilizado y entregado a las autoridades. Se evit√≥ el robo y se mantuvo la seguridad del personal.'},
            n_end_fail: {type: 'end', text: 'El intruso evade a los guardias o hiere a uno de ellos antes de huir con material valioso. Falla grave en el control de acceso.'}
          },
          choices: {
            c_send_patrol: {from: 'n_start', to: 'n_send_patrol', effects: {time: -5, security: -5}, desc: 'Enviar patrulla a inspeccionar la zona de inmediato'},
            c_monitor_only: {from: 'n_start', to: 'n_end_fail', effects: {security: -10, procedural: -10}, desc: 'Solo monitorear y esperar a ver qu√© hace'},
            c_call_police: {from: 'n_start', to: 'n_call_police', effects: {procedural: 10, comms: 15}, desc: 'Notificar inmediatamente a la polic√≠a y a la central de operaciones'},
            c_intercept: {from: 'n_send_patrol', to: 'n_end_fail', effects: {security: -15}, desc: 'Interceptar al intruso sin saber su armamento'},
            c_establish_overwatch: {from: 'n_send_patrol', to: 'n_call_police', effects: {security: 10, procedural: 5}, desc: 'Establecer vigilancia discreta y esperar la llegada de la polic√≠a'},
            c_intercept_soft: {from: 'n_call_police', to: 'n_end_fail', effects: {security: -10}, desc: 'Intentar disuadirlo verbalmente (riesgo si est√° armado)'},
            c_wait_police: {from: 'n_call_police', to: 'n_end_ok', effects: {procedural: 15, security: 15, time: 5}, desc: 'Mantener la posici√≥n de vigilancia hasta la llegada de la fuerza p√∫blica'}
          }
        },
        {
          id: 'm_accidente_maquinaria',
          title: 'Incidente con Maquinaria Pesada',
          area: 'mineria',
          difficulty: 'medio',
          est_time: 8,
          start: 'n_start',
          nodes: {
            n_start: {type: 'info', text: 'Se oye un fuerte golpe y se ve un cami√≥n minero volcado. El operador est√° atrapado, y hay derrame de fluidos.', choices: ['c_first_aid', 'c_isolate_power', 'c_call_rescue']},
            n_isolate_power: {type: 'event', text: 'Aseguras que la energ√≠a del √°rea y la maquinaria est√°n desconectadas. El tiempo de respuesta es vital.', choices: ['c_start_extrication', 'c_wait_rescue']},
            n_call_rescue: {type: 'event', text: 'Llamaste al equipo de rescate y a emergencias m√©dicas. Ahora, ¬øqu√© haces en el sitio?', choices: ['c_first_aid_wait', 'c_direct_traffic']},
            n_end_ok: {type: 'end', text: 'El operador fue rescatado y estabilizado. El procedimiento de emergencia y aislamiento de riesgos fue ejecutado de manera √≥ptima.'},
            n_end_fail: {type: 'end', text: 'El derrame de fluidos causa un resbal√≥n y un guardia resulta herido. El operador sufre lesiones graves debido a la demora en la ayuda especializada.'}
          },
          choices: {
            c_first_aid: {from: 'n_start', to: 'n_end_fail', effects: {security: -10, time: -5}, desc: 'Intentar primeros auxilios sin asegurar la escena (riesgo de derrumbes/fluidos)'},
            c_isolate_power: {from: 'n_start', to: 'n_isolate_power', effects: {procedural: 15, security: 10}, desc: 'Priorizar el aislamiento de riesgos (energ√≠a, fluidos) y luego llamar'},
            c_call_rescue: {from: 'n_start', to: 'n_call_rescue', effects: {comms: 10, time: 5}, desc: 'Llamar al equipo de rescate y emergencias inmediatamente'},
            c_start_extrication: {from: 'n_isolate_power', to: 'n_end_fail', effects: {security: -15, procedural: -10}, desc: 'Intentar sacar al operador sin el equipo de rescate especializado'},
            c_wait_rescue: {from: 'n_isolate_power', to: 'n_end_ok', effects: {procedural: 10, security: 5, time: 10}, desc: 'Mantener la seguridad de la escena y esperar al equipo especializado'},
            c_first_aid_wait: {from: 'n_call_rescue', to: 'n_end_ok', effects: {empathy: 5, procedural: 5}, desc: 'Proporcionar soporte b√°sico (primeros auxilios) mientras llega la ayuda'},
            c_direct_traffic: {from: 'n_call_rescue', to: 'n_end_fail', effects: {security: -10}, desc: 'Olvidarse del operador y dedicarse a controlar el tr√°fico de la zona'}
          }
        }
      ],
      "energia": [
        {
          id: 'e_vandalismo_subestacion',
          title: 'Vandalismo en Subestaci√≥n Remota',
          area: 'energia',
          difficulty: 'alto',
          est_time: 9,
          start: 'n_start',
          nodes: {
            n_start: {type: 'info', text: 'Alarma de intrusi√≥n en una subestaci√≥n el√©ctrica remota. Se ven dos figuras intentando da√±ar un transformador vital.', choices: ['c_approach_fast', 'c_call_police_first', 'c_activate_siren']},
            n_call_police_first: {type: 'event', text: 'Has llamado a la polic√≠a y a la jefatura. Se te indica monitorear desde una distancia segura.', choices: ['c_warn_loud', 'c_wait_silent']},
            n_activate_siren: {type: 'event', text: 'Activas la alarma audible y luces de la subestaci√≥n. Los intrusos se asustan y comienzan a correr.', choices: ['c_pursuit_vehicle', 'c_secure_damage']},
            n_end_ok: {type: 'end', text: 'Los sospechosos fueron disuadidos por la alarma y la polic√≠a los intercept√≥ en el per√≠metro. Se evit√≥ un corte de energ√≠a mayor.'},
            n_end_fail: {type: 'end', text: 'Los intrusos cortan un cable y causan un arco el√©ctrico, dej√°ndote sin comunicaci√≥n y exponiendo tu posici√≥n.'}
          },
          choices: {
            c_approach_fast: {from: 'n_start', to: 'n_end_fail', effects: {security: -20, procedural: -15}, desc: 'Acercarse r√°pidamente y solo para confrontar la amenaza el√©ctrica y de seguridad'},
            c_call_police_first: {from: 'n_start', to: 'n_call_police_first', effects: {procedural: 15, comms: 10, time: 5}, desc: 'Notificar de inmediato a la polic√≠a y central (procedimiento cr√≠tico)'},
            c_activate_siren: {from: 'n_start', to: 'n_activate_siren', effects: {security: 5, time: 10}, desc: 'Activar sirena y luces de advertencia para disuadir a los intrusos'},
            c_warn_loud: {from: 'n_call_police_first', to: 'n_activate_siren', effects: {time: -5}, desc: 'Usar altavoz para advertir su presencia (puede ser contraproducente)'},
            c_wait_silent: {from: 'n_call_police_first', to: 'n_end_ok', effects: {procedural: 10, security: 10}, desc: 'Mantener la vigilancia encubierta hasta la llegada de la fuerza p√∫blica'},
            c_pursuit_vehicle: {from: 'n_activate_siren', to: 'n_end_fail', effects: {security: -10, time: -10}, desc: 'Perseguir a los intrusos en veh√≠culo sin esperar refuerzos'},
            c_secure_damage: {from: 'n_activate_siren', to: 'n_end_ok', effects: {procedural: 5, security: 5}, desc: 'Verificar da√±os desde la distancia y asegurar el √°rea inmediata'}
          }
        },
        {
          id: 'e_fuga_combustible',
          title: 'Derrame de Combustible',
          area: 'energia',
          difficulty: 'medio',
          est_time: 7,
          start: 'n_start',
          nodes: {
            n_start: {type: 'info', text: 'Durante una ronda, se detecta un fuerte olor a combustible y se ve un charco creciendo cerca de un generador auxiliar. Alto riesgo de incendio.', choices: ['c_stop_leak_solo', 'c_fire_protocol', 'c_notify_hsm']},
            n_fire_protocol: {type: 'event', text: 'Has activado la alarma de incendio/fuga. El personal no esencial est√° evacuando.', choices: ['c_use_absorbent', 'c_wait_firemen']},
            n_notify_hsm: {type: 'event', text: 'Notificaste a la central y al equipo de Seguridad, Salud y Medio Ambiente (SSMA). Est√°n en camino con barreras de contenci√≥n.', choices: ['c_isolate_source', 'c_evac_zone']},
            n_end_ok: {type: 'end', text: 'La fuga fue controlada y el combustible contenido. Se evit√≥ una explosi√≥n y el impacto ambiental fue m√≠nimo. Protocolo SSMA aplicado con √©xito.'},
            n_end_fail: {type: 'end', text: 'Un vapor del combustible entra en contacto con una chispa. Hay una peque√±a explosi√≥n que hiere a personal y detiene la planta.'}
          },
          choices: {
            c_stop_leak_solo: {from: 'n_start', to: 'n_end_fail', effects: {security: -15, procedural: -10}, desc: 'Intentar detener la fuga con herramientas a mano sin equipo de protecci√≥n ni apoyo'},
            c_fire_protocol: {from: 'n_start', to: 'n_fire_protocol', effects: {procedural: 10, comms: 5}, desc: 'Activar el protocolo de emergencia (alarma, evacuaci√≥n) y llamar a bomberos'},
            c_notify_hsm: {from: 'n_start', to: 'n_notify_hsm', effects: {procedural: 15, security: 10, time: 5}, desc: 'Notificar al equipo SSMA y pedir equipo de contenci√≥n (opci√≥n m√°s segura)'},
            c_use_absorbent: {from: 'n_fire_protocol', to: 'n_end_fail', effects: {time: -10, security: -5}, desc: 'Intentar usar material absorbente por tu cuenta sin equipo SSMA'},
            c_wait_firemen: {from: 'n_fire_protocol', to: 'n_notify_hsm', effects: {procedural: 5, time: 10}, desc: 'Asegurar el per√≠metro y esperar que el personal SSMA/bomberos tomen el control'},
            c_isolate_source: {from: 'n_notify_hsm', to: 'n_end_fail', effects: {security: -10, procedural: -5}, desc: 'Intentar mover el contenedor o cerrar la llave sin equipo adecuado'},
            c_evac_zone: {from: 'n_notify_hsm', to: 'n_end_ok', effects: {procedural: 10, security: 10}, desc: 'Asegurar la evacuaci√≥n total del personal en la zona de riesgo'}
          }
        }
      ]
    };
  </script>
</body>
</html>